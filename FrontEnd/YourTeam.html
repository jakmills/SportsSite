<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favorite Teams</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class = "navbar">
        <a href="Home.html">Home</a>
        <a href="YourTeam.html">Your Team</a>
        <a href="News.html">News</a>
        <a href="Profile.html">Profile</a>
    </div>
    <!-- List of favorite teams and when their next fixture is -->
    <main>
        <section id="favorites" class="favorites">
            <h2>Your Teams</h2>
            <div id="favorites-empty" class="favorites-empty" style="display:none;">
                <p>You haven't favorited any teams yet. Go to a team's page and click the ♥ to add them here.</p>
            </div>
            <div id="favorites-list" class="favorites-list">
                <!-- JS will populate favorite team cards here -->
            </div>
        </section>
    </main>

    <script>
    // Frontend contract: GET /api/user/favorites -> { teams: [ { id, name, logo?, nextFixture?: string, opponent?: string, time?: string, link?: string } ] }
    document.addEventListener('DOMContentLoaded', function () {
        const list = document.getElementById('favorites-list');
        const empty = document.getElementById('favorites-empty');

        function showEmpty() {
            list.style.display = 'none';
            empty.style.display = 'block';
        }

        function showList() {
            list.style.display = 'grid';
            empty.style.display = 'none';
        }

        // Start hidden while fetching
        list.style.display = 'none';
        empty.style.display = 'none';

        fetch('/api/user/favorites', { cache: 'no-store' })
            .then(resp => {
                if (!resp.ok) throw new Error('Network response not ok');
                return resp.json();
            })
            .then(data => {
                const teams = Array.isArray(data && data.teams) ? data.teams : [];
                if (teams.length === 0) {
                    showEmpty();
                    return;
                }

                list.innerHTML = '';
                teams.forEach(team => {
                    const card = document.createElement('article');
                    card.className = 'favorite-team';

                    if (team.logo) {
                        const img = document.createElement('img');
                        img.src = team.logo;
                        img.alt = `${team.name} logo`;
                        img.className = 'favorite-team-logo';
                        card.appendChild(img);
                    }

                    const info = document.createElement('div');
                    info.className = 'favorite-team-info';

                    const title = document.createElement('h3');
                    title.textContent = team.name || 'Unnamed team';
                    info.appendChild(title);

                    if (team.nextFixture || team.opponent || team.time) {
                        const fixture = document.createElement('p');
                        fixture.className = 'favorite-team-fixture';
                        const parts = [];
                        if (team.nextFixture) parts.push(team.nextFixture);
                        if (team.opponent) parts.push(`vs ${team.opponent}`);
                        if (team.time) parts.push(team.time);
                        fixture.textContent = parts.join(' • ');
                        info.appendChild(fixture);
                    }

                    card.appendChild(info);

                    if (team.link) {
                        const a = document.createElement('a');
                        a.href = team.link;
                        a.textContent = 'View';
                        a.className = 'favorite-team-link';
                        card.appendChild(a);
                    }

                    list.appendChild(card);
                });

                showList();
            })
            .catch(err => {
                console.warn('Failed to load favorite teams:', err);
                // Show empty state on error to avoid exposing stack traces to users
                showEmpty();
            });
    });
    </script>
</body>
</html>